<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Ohm's Law Simulation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
        }
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
        }
        .slider-group {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 200px;
            margin-right: 10px;
        }
        .value {
            color: #4CAF50;
            font-weight: bold;
        }
        
        #powerStatus {
            color: #ff0000;
            transition: color 0.3s ease;
        }
        
        #powerStatus.on {
            color: #00ff00;
        }
        
        .switch-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="info">
        <h3>Ohm's Law: V = I × R</h3>
        <div>Voltage (V): <span id="voltageDisplay" class="value">12.0</span> V</div>
        <div>Current (I): <span id="currentDisplay" class="value">2.0</span> A</div>
        <div>Resistance (R): <span id="resistanceDisplay" class="value">6.0</span> Ω</div>
        <div>Power: <span id="powerStatus" class="value">OFF</span></div>
        <div style="margin-top: 10px; font-size: 12px;">
            Current flow visualized by moving particles
        </div>
    </div>

    <div id="controls">
        <h4>Circuit Controls</h4>
        <div class="slider-group">
            <label for="voltageSlider">Voltage (V)</label>
            <input type="range" id="voltageSlider" min="1" max="24" step="0.5" value="12">
            <span id="voltageValue">12.0</span> V
        </div>
        
        <div class="slider-group">
            <label for="resistanceSlider">Resistance (Ω)</label>
            <input type="range" id="resistanceSlider" min="1" max="20" step="0.5" value="6">
            <span id="resistanceValue">6.0</span> Ω
        </div>
    </div>

    <div class="switch-hint">
        Click the switch to turn the circuit on/off
    </div>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.156.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.156.1/examples/jsm/"
        }
    }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        class OhmsLawSimulation {
            constructor() {
                this.voltage = 12.0;
                this.resistance = 6.0;
                this.current = this.voltage / this.resistance;
                
                this.particles = [];
                this.circuit = {};
                
                this.init();
                this.createCircuit();
                this.createCurrentParticles();
                this.setupControls();
                this.animate();
            }

            init() {
                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x0f0f23);

                // Camera
                this.camera = new THREE.PerspectiveCamera(
                    75,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(0, 8, 12);

                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                document.getElementById('container').appendChild(this.renderer.domElement);

                // Controls
                this.controls = new OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;

                // Lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                this.scene.add(directionalLight);

                // Grid helper
                const gridHelper = new THREE.GridHelper(20, 20, 0x333333, 0x333333);
                this.scene.add(gridHelper);
            }

            createCircuit() {
                // Circuit board base
                const boardGeometry = new THREE.BoxGeometry(12, 0.2, 8);
                const boardMaterial = new THREE.MeshLambertMaterial({ color: 0x2d5016 });
                const board = new THREE.Mesh(boardGeometry, boardMaterial);
                board.position.y = 0.1;
                this.scene.add(board);

                // Battery
                const batteryGeometry = new THREE.CylinderGeometry(0.5, 0.5, 3, 16);
                const batteryMaterial = new THREE.MeshLambertMaterial({ color: 0xff6b6b });
                this.circuit.battery = new THREE.Mesh(batteryGeometry, batteryMaterial);
                this.circuit.battery.position.set(-4, 1.8, 0);
                this.circuit.battery.rotation.z = Math.PI / 2;
                this.scene.add(this.circuit.battery);

                // Resistor
                const resistorGeometry = new THREE.CylinderGeometry(0.3, 0.3, 2, 16);
                const resistorMaterial = new THREE.MeshLambertMaterial({ color: 0xffb74d });
                this.circuit.resistor = new THREE.Mesh(resistorGeometry, resistorMaterial);
                this.circuit.resistor.position.set(4, 1.8, 0);
                this.circuit.resistor.rotation.z = Math.PI / 2;
                this.scene.add(this.circuit.resistor);

                // Wires
                const wireGeometry = new THREE.CylinderGeometry(0.05, 0.05, 1, 8);
                const wireMaterial = new THREE.MeshLambertMaterial({ color: 0x4fc3f7 });

                // Create wire segments
                const wires = [
                    { pos: [0, 3, 0], rot: [0, 0, Math.PI/2], scale: [6, 1, 1] },
                    { pos: [0, 0.6, 0], rot: [0, 0, Math.PI/2], scale: [6, 1, 1] },
                    { pos: [-5.5, 1.8, 0], rot: [0, 0, 0], scale: [1, 2.4, 1] },
                    { pos: [5, 1.8, 0], rot: [0, 0, 0], scale: [1, 2.4, 1] }
                ];

                wires.forEach(wire => {
                    const mesh = new THREE.Mesh(wireGeometry, wireMaterial);
                    mesh.position.set(...wire.pos);
                    mesh.rotation.set(...wire.rot);
                    mesh.scale.set(...wire.scale);
                    this.scene.add(mesh);
                });

                // Current arrow
                const arrowGeometry = new THREE.ConeGeometry(0.2, 0.5, 8);
                const arrowMaterial = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
                this.circuit.arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);
                this.circuit.arrow.position.set(-2, 3.5, 0);
                this.circuit.arrow.rotation.z = -Math.PI / 2;
                this.scene.add(this.circuit.arrow);
            }

            createCurrentParticles() {
                const particleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                const particleMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0xffff00,
                    emissive: 0x444400
                });

                for (let i = 0; i < 20; i++) {
                    const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                    const t = i / 20;
                    
                    if (t < 0.25) {
                        const x = THREE.MathUtils.lerp(-5.5, 5, t * 4);
                        particle.position.set(x, 3, 0);
                    } else if (t < 0.5) {
                        const y = THREE.MathUtils.lerp(3, 0.6, (t - 0.25) * 4);
                        particle.position.set(5, y, 0);
                    } else if (t < 0.75) {
                        const x = THREE.MathUtils.lerp(5, -5.5, (t - 0.5) * 4);
                        particle.position.set(x, 0.6, 0);
                    } else {
                        const y = THREE.MathUtils.lerp(0.6, 3, (t - 0.75) * 4);
                        particle.position.set(-5.5, y, 0);
                    }
                    
                    particle.userData = { t: t };
                    this.particles.push(particle);
                    this.scene.add(particle);
                }
            }

            updateParticles() {
                this.particles.forEach(particle => {
                    const speed = this.current * 0.002;
                    particle.userData.t += speed;
                    
                    if (particle.userData.t > 1) {
                        particle.userData.t = 0;
                    }
                    
                    const t = particle.userData.t;
                    
                    if (t < 0.25) {
                        const x = THREE.MathUtils.lerp(-5.5, 5, t * 4);
                        particle.position.set(x, 3, 0);
                    } else if (t < 0.5) {
                        const y = THREE.MathUtils.lerp(3, 0.6, (t - 0.25) * 4);
                        particle.position.set(5, y, 0);
                    } else if (t < 0.75) {
                        const x = THREE.MathUtils.lerp(5, -5.5, (t - 0.5) * 4);
                        particle.position.set(x, 0.6, 0);
                    } else {
                        const y = THREE.MathUtils.lerp(0.6, 3, (t - 0.75) * 4);
                        particle.position.set(-5.5, y, 0);
                    }
                    
                    const scale = 0.5 + (this.current / 10);
                    particle.scale.setScalar(scale);
                });
            }

            setupControls() {
                const voltageSlider = document.getElementById('voltageSlider');
                const resistanceSlider = document.getElementById('resistanceSlider');
                
                voltageSlider.addEventListener('input', (e) => {
                    this.voltage = parseFloat(e.target.value);
                    this.updateValues();
                });
                
                resistanceSlider.addEventListener('input', (e) => {
                    this.resistance = parseFloat(e.target.value);
                    this.updateValues();
                });
            }

            updateValues() {
                this.current = this.voltage / this.resistance;
                
                document.getElementById('voltageDisplay').textContent = this.voltage.toFixed(1);
                document.getElementById('currentDisplay').textContent = this.current.toFixed(2);
                document.getElementById('resistanceDisplay').textContent = this.resistance.toFixed(1);
                
                document.getElementById('voltageValue').textContent = this.voltage.toFixed(1);
                document.getElementById('resistanceValue').textContent = this.resistance.toFixed(1);
                
                const intensity = Math.min(this.current / 5, 1);
                this.circuit.arrow.material.color.setHSL(0.3, 1, 0.3 + intensity * 0.4);
                this.circuit.arrow.scale.setScalar(0.5 + intensity * 1.5);
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                this.controls.update();
                this.updateParticles();
                
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Initialize simulation
        const simulation = new OhmsLawSimulation();
        simulation.updateValues();

        // Handle window resize
        window.addEventListener('resize', () => {
            simulation.camera.aspect = window.innerWidth / window.innerHeight;
            simulation.camera.updateProjectionMatrix();
            simulation.renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
